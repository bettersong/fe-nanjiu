## 前言

一个页面的核心由HTML、CSS和JavaScript构成，三者紧密联系驱动内容的呈现与交互。但浏览器如何解析它们？资源加载的先后顺序如何影响用户体验？通过本文，你将掌握这些内容：

1. 为什么需要生成DOM树？
2. css是否会阻塞html的解析？css是否会阻塞DOM树的渲染？
3. javascript是否会阻塞html的解析？
4. javascript的异步加载机制对html解析的影响

## 认识DOM

> 文档对象模型（Document Object Model，简称 DOM），是 W3C 组织推荐的处理可扩展置标语言的标准编程接口。DOM 把整个页面映射为一个多层的节点结构，HTML 或 XML 页面中的每个组成部分都是某种类型的节点，这些节点又包含着不同类型的数据。

W3C DOM 由以下三部分组成：

- 核心 DOM - 针对任何结构化文档的标准模型
- XML DOM - 针对 XML 文档的标准模型
- HTML DOM - 针对 HTML 文档的标准模型

如果觉得这样介绍不够直观，可以看下这张图

![DOM HTML tree](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2025/2025-04/images/2-1.gif)

各个dom节点组合起来就形成了一个树状结构，所以我们通常称之为**DOM树**。

### 为什么需要DOM树？

- 结构化数据：将HTML标签（如`<div>`、`<p>`）和文本内容转化为**节点对象**，以树形结构表示标签的父子嵌套关系。
- JavaScript动态操作的基础：这一过程解决了原生HTML文本的局限性，允许JavaScript通过属性与方法直接操作节点。
- 渲染过程的核心输入：DOM树提供内容结构，CSSOM树提供样式规则，两者结合生成渲染树（Render Tree），决定页面元素的可见性与布局。
- 安全性：DOM解析阶段会过滤恶意内容。

## 构建DOM树

首先是加载`html`文档，这其中当然也包括`css`与`javascript`部分。只有当html文档加载完成后，浏览器才会开始进行解析处理生成DOM树。

### 解析HTML

![img](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2025/2025-04/images/2-1.2.png)

在这个过程中每个HTML标签都会被浏览器解析成文档对象，并且所有的文档对象最终都会被挂在`document`上

比如：

![image-20250416164615952](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2025/2025-04/images/2-2.png)

并且为了提高解析效率，在解析之前，浏览器会启动一个预解析的线程，提前去下载文档中的外部CSS文件和外部JS文件。

### 解析CSS

在构建DOM的过程中，如果遇到`link`标签，当把它插入到DOM树上后，此时如果外部的CSS文件还没有下载完，主线程也不会停下来等待，因为**下载和解析CSS的工作是在预解析线程中进行的，**所以CSS并不会阻塞html的解析。


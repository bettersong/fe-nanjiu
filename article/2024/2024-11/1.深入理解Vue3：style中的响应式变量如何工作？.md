## å‰è¨€

åœ¨å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬çš„`style`æ ·å¼å¯èƒ½ä¼šæ ¹æ®ä¸šåŠ¡é€»è¾‘çš„å˜åŒ–è€Œå˜åŒ–ï¼Œè¿™ä¸ªæ—¶å€™å¤§å®¶æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹æ¡ˆå°±æ˜¯å¤šå†™å‡ ä¸ª`class`ç±»ï¼Œæ ¹æ®ä¸åŒåœºæ™¯åº”ç”¨ä¸åŒçš„ç±»ï¼Œæ¯”å¦‚è¿™æ ·ï¼š

```vue
<div
  :class="{
  [$style.sign_day]: true,
  [$style.sign_today]: getSignStatus(item) == 1,
  [$style.sign_notyet_day]: getSignStatus(item) == 6,
  [$style.sign_day_dark]: theme == 'dark',
  }"
>
</div>
```

```vue
<style lang="scss" module>
  .sign_day {
    background: red;
  }
  .sign_today {
    background: yellow;
  }
  .sign_notyet_day {
    background: blue;
  }
  .sign_day_dark {
    background: orange;
  }
</style>
```

è¿™æ ·è™½ç„¶ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„æ–¹å¼ï¼Œä½†æ˜¯å¦‚æœç±»å‹æœ‰éå¸¸å¤šçš„è¯ï¼Œé‚£ä¹ˆä½ å°±å¾—åœ¨`vue`æ¨¡ç‰ˆé‡Œé¢å†™å¤§é‡çš„åˆ¤æ–­è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åœ¨`style`ä¸­å†™å¤§é‡çš„`class`ç±»ã€‚

è¦æ˜¯åœ¨`style`ä¸­ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨`script`ä¸­çš„**JSå˜é‡**ï¼Œé‚£ä¹ˆè¿™ç§åœºæ™¯å¤„ç†èµ·æ¥æ˜¯ä¸æ˜¯ä¼šæ›´æ–¹ä¾¿ä¸€ç‚¹å‘¢ï¼Ÿ

## Vue2 CSSå˜é‡

åœ¨`Vue2`ä¸­ï¼Œé‡åˆ°ä»¥ä¸Šä¸šåŠ¡åœºæ™¯å¦‚æœæˆ‘ä»¬ä¸æƒ³å†™å¤§é‡çš„`class`ç±»çš„è¯ï¼Œå¯ä»¥å€ŸåŠ©`css`ä¸­çš„`var()`å‡½æ•°æ¥å®ç°

> **`var()`**å¯ä»¥æ’å…¥ä¸€ä¸ª[è‡ªå®šä¹‰å±æ€§](https://developer.mozilla.org/zh-CN/docs/Web/CSS/--*)ï¼ˆæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºâ€œCSS å˜é‡â€ï¼‰çš„å€¼ï¼Œç”¨æ¥ä»£æ›¿éè‡ªå®šä¹‰å±æ€§ä¸­å€¼çš„ä»»ä½•éƒ¨åˆ†ã€‚

**æ¯”å¦‚ï¼š**

åœ¨æ¨¡ç‰ˆä¸­è°ƒç”¨`getStyle`å‡½æ•°è·å–é¢œè‰²å€¼ï¼Œå¹¶ä¸”å®šä¹‰æˆ`csså˜é‡`

```vue
<div
v-for="item in signList"
:key="item.day"
:class="$style.sign_day"
:style="{ '--color': getStyle(item) }"
>
  {{ item.title }}
</div>
```

ç”Ÿæˆé¢œè‰²å€¼

```js
getStyle(item) {
  switch (item.status) {
    case 0:
      return '#f8ae00'
    case 1:
      return '#e5353e'
    case 2:
      return '#1fddf4'
    case 3:
      return '#1ff46a'
    default:
      return '#191919'
  }
},
```

ç„¶åå°±å¯ä»¥åªå†™ä¸€ä¸ª`cssç±»`äº†

```scss
.sign_day {
  width: calc((100vw - 72px) / 4);
  height: 80px;
  margin-top: 8px;
  border-radius: 8px;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #f5f5f5;
  color: var(--color);
}
```

<img src="/Users/songyao/Library/Application Support/typora-user-images/image-20241124221220784.png" alt="image-20241124221220784" style="zoom:30%;" />

**è¿™ç§æ–¹æ¡ˆçš„åŸç†å…¶å®å°±æ˜¯å€ŸåŠ©äº†CSSçš„è‡ªå®šä¹‰å˜é‡ä»¥åŠCSSçš„ä½œç”¨åŸŸæ¥å®ç°çš„**

æ‰€ä»¥å®ƒéœ€è¦ä¸¤æ­¥ï¼š

- è‡ªå®šä¹‰CSSå˜é‡ï¼ˆè€ƒè™‘ä½œç”¨åŸŸèŒƒå›´ï¼‰
- ä½¿ç”¨CSSå˜é‡

å®é™…ä¸Šåœ¨Vue3ä¸­è¿˜æœ‰æ›´ç®€ä¾¿çš„æ–¹æ¡ˆï¼

## Vue3 v-bind()

> åœ¨Vue3å•æ–‡ä»¶ç»„ä»¶çš„ `<style>` æ ‡ç­¾æ”¯æŒä½¿ç”¨ `v-bind`  å‡½æ•°å°† CSS çš„å€¼é“¾æ¥åˆ°ç»„ä»¶ä¸­çš„æ•°æ®ã€‚

æ‰€ä»¥ä»¥ä¸Šåœºæ™¯è¿˜å¯ä»¥è¿™æ ·å®ç°ï¼š

æ¨¡ç‰ˆï¼š

```vue
<div :class="$style.day_item">
  {{ dayItem.title }}
</div>
```

è®¡ç®—é¢œè‰²å€¼ï¼š

```js
const color = computed(() => {
    switch (props.dayItem.status) {
    case 0:
        return '#f8ae00'
    case 1:
        return '#e5353e'
    case 2:
        return '#1fddf4'
    case 3:
        return '#1ff46a'
    default:
        return '#191919'
    }
})
```

style è°ƒç”¨`v-bind()`ä½¿ç”¨setupä¸­çš„å˜é‡

```vue
<style lang="scss" module>
.day_item {
    color: v-bind(color);
}
</style>
```

<img src="/Users/songyao/Library/Application Support/typora-user-images/image-20241125162645148.png" alt="image-20241125162645148" style="zoom:30%;" />

ä»è¯¥å›¾æˆ‘ä»¬å¯ä»¥å‘ç°Vue3ä¸­çš„`v-bind()`åŸç†ä¸ä¸Šé¢çš„CSSå˜é‡çš„åŸç†ä¸€æ ·ï¼Œéƒ½æ˜¯**å€ŸåŠ©äº†CSSçš„è‡ªå®šä¹‰å˜é‡ä»¥åŠCSSçš„ä½œç”¨åŸŸæ¥å®ç°çš„**

åªä¸è¿‡ä¸åŒçš„æ˜¯`v-bind()`ç”Ÿæˆçš„CSSå˜é‡å‰é¢å¤šäº†ä¸€ä¸²`hash`

## Vue3æ˜¯å¦‚ä½•ç¼–è¯‘v-bind()çš„ï¼Ÿ

### çŒœæµ‹æµç¨‹

æˆ‘ä»¬å¯ä»¥ä»ç¼–è¯‘ç»“æœæ¥è¿›è¡Œåæ¨

é¦–å…ˆæ˜¯æˆ‘ä»¬çš„JSéƒ¨åˆ†ï¼Œç¼–è¯‘æˆäº†ä»¥ä¸‹å†…å®¹ï¼š

![image-20241128194601008](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-3.png)

è¿™é‡Œä¼šæ¯”æ²¡ä½¿ç”¨`v-bind()`çš„ç»„ä»¶å¤šå‡ºä¸€ä¸ª`_useCssVars()`å‡½æ•°

```js
_useCssVars((_ctx) => ({
  "5d92a9f9-color": color.value
}));
```

èƒ½ä¸èƒ½çŒœåˆ°è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœä¸èƒ½ï¼Œæ¥ç€çœ‹ä¸‹é¢ä¸€å¼ å›¾ğŸ‘‡

![image-20241128195048742](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-4.png)

è¿™å¼ å›¾æ˜¯ç»„ä»¶çš„`style`éƒ¨åˆ†ç¼–è¯‘ä¹‹åçš„äº§ç‰©ï¼Œå¯ä»¥çœ‹åˆ°

```css
.day_item {
    color: v-bind(color);
}
```

ç¼–è¯‘æˆäº†

```js
"._day_item_1oe25_1 {\n  color: var(--5d92a9f9-color);\n}"
```

ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä½¿ç”¨çš„`v-bind`æœ€ç»ˆä¹Ÿæ˜¯ç¼–è¯‘æˆäº†åŸç”ŸCSSä¸­`var`å‡½æ•°ï¼ŒåŸç†ä¹Ÿæ˜¯ä½¿ç”¨**CSSçš„è‡ªå®šä¹‰å˜é‡**

ä½†æ˜¯è¿™é‡Œåªæœ‰ä½¿ç”¨ï¼Œå¹¶æ²¡çœ‹åˆ°`csså˜é‡å®šä¹‰`çš„åœ°æ–¹ğŸ¤”ï¼Œç°åœ¨èƒ½å¤ŸçŒœæµ‹åˆ°`_useCssVars()`å‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆå—ï¼Ÿå¤§æ¦‚ç‡å°±æ˜¯ç”¨æ¥ç”Ÿæˆ`cssè‡ªå®šä¹‰å˜é‡`äº†ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åˆ°æºç ä¸­è¿›è¡ŒéªŒè¯ï¼š

### æºç éªŒè¯

1. **æ‰¾åˆ°æºç ä¸­çš„`doCompileStyle`å‡½æ•°ï¼Œæ‰“ä¸Šæ–­ç‚¹ï¼Œç„¶åå°±å¯ä»¥å¯åŠ¨`debug`æ¨¡å¼äº†**

![image-20241129110337586](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-5.png)

2. **æ¥ç€å¾€ä¸‹èµ°ä½ ä¼šçœ‹åˆ°ä¸€ä¸ª`shortId`å˜é‡ï¼Œå®ƒæ­¤æ—¶çš„å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ**

![image-20241129110725177](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-6.png)

æ˜¯ä¸æ˜¯æœ‰ç‚¹çœ¼ç†Ÿï¼Œæ²¡é”™å®ƒå°±æ˜¯åé¢ä¼šå‡ºç°åœ¨CSSå˜é‡å‰é¢çš„é‚£ä¸€ä¸²`hash`

3. **å†æ¥ç€å¾€ä¸‹èµ°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°`postcss`æ’ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ª`cssVarsPlugin`æ’ä»¶**

![image-20241129120323822](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-7.png)

è¿™ä¸ªæ’ä»¶çš„ä½œç”¨å¤§å®¶æ˜¯ä¸æ˜¯å·²ç»çŒœåˆ°æ˜¯å¹²å˜›çš„äº†ï¼Œæ¥ç€å¾€ä¸‹èµ°

4. **åœ¨`cssVarsPlugin`è¿™ä¸ªæ–¹æ³•ä¸­å†åŠ ä¸€ä¸ªæ–­ç‚¹**

![image-20241129143616787](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-8.png)

å¯ä»¥çœ‹åˆ°æ­¤æ—¶è¿›æ¥çš„`decl`å‚æ•°æ˜¯ï¼š`color: v-bind(color)`

ç†Ÿæ‚‰`postcss`çš„åŒå­¦åº”è¯¥èƒ½çŸ¥é“`decl`æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯cssè½¬åŒ–ä¸º`AST`åçš„ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹

```js
const vBindRE = /v-bind\s*\(/g;
```

å°†CSSå£°æ˜ä¸­çš„å±æ€§å€¼**v-bind(color)**ç»è¿‡`vBindRE`æ­£åˆ™è¿›è¡Œæ£€æµ‹æ˜¯å¦ä¸º`v-bind()`è¯­å¥

å†å¾€ä¸‹ï¼Œè¿™é‡Œå°±æ˜¯`v-bind()`è¯­å¥ç¼–è¯‘çš„æ ¸å¿ƒä»£ç äº†

![image-20241129142424198](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-9.png)

é¦–å…ˆæ˜¯æå–å˜é‡å

![image-20241129144226449](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-10.png)

è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œåçš„ç»“æœæ˜¯`'color'`ï¼Œä¹Ÿå°±æ˜¯`v-bind()`æ‹¬å·ä¸­çš„è¿™ä¸ªå˜é‡äº†

å†å¾€ä¸‹

![image-20241129151802913](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-11.png)

æ­¤æ—¶å°±èƒ½çœ‹åˆ°æ•´ä¸ªç¼–è¯‘ç»“æœäº†ï¼š`v-bind(color)` ---> `var(--5d92a9f9-color)`

**å¯ä»¥çœ‹åˆ°`v-bind()`çš„ç¼–è¯‘å…¶å®å°±æ˜¯é€šè¿‡æ­£åˆ™å¤„ç†é‡æ–°ç”Ÿæˆå­—ç¬¦ä¸²**

ç°åœ¨çŸ¥é“`v-bind()`æ˜¯å¦‚ä½•ç¼–è¯‘çš„ï¼Œå‰©ä¸‹ä¸€ä¸ªé‡ç‚¹å°±æ˜¯ï¼šVueæ˜¯å¦‚ä½•æŠŠ`style`ä¸­ä½¿ç”¨çš„å˜é‡è½¬æ¢æˆ`CSSå˜é‡`å¹¶è®¾ç½®åœ¨å¯¹åº”domèŠ‚ç‚¹ä¸Šçš„

è¿™ä¸ªçªç ´ç‚¹åœ¨æˆ‘ä»¬ä¸Šé¢çŒœæµ‹æµç¨‹çš„ç¬¬ä¸€å¼ å›¾ï¼Œé‡Œé¢æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š

```js
_useCssVars((_ctx) => ({
  "5d92a9f9-color": color.value
}));
```

å¾ˆæ˜æ˜¾ï¼Œå®ƒå°±æ˜¯ç”¨æ¥ç”ŸæˆCSSå˜é‡

5. **æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åœ¨æºç ä¸­æ‰¾åˆ°è¿™ä¸ªå‡½æ•°ï¼Œå¹¶æ‰“ä¸Šæ–­ç‚¹**

åœ¨æºç ä¸­æœç´¢`_useCssVars`ï¼Œä½ ä¼šå‘ç°ä»€ä¹ˆä¹Ÿæœä¸åˆ°ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥å°è¯•å»æ‰`_`ä»”è¿›è¡Œæœç´¢ï¼Œä½ ä¼šå‘ç°æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š

```js
const CSS_VARS_HELPER = `useCssVars`;
```

å¾ˆæ˜æ˜¾ï¼Œåé¢åœ¨æºç ä¸­æˆ‘ä»¬åªéœ€è¦æœç´¢`CSS_VARS_HELPER`å°±å¯ä»¥ï¼Œæ‰¾åˆ°ä»¥ä¸‹ä»£ç ï¼Œæ‰“ä¸Šæ–­ç‚¹ï¼Œåˆ·æ–°é¡µé¢

![image-20241129191909735](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-12.png)

æˆ‘ä»¬ä¼šå‘ç°è¿™ä¸€æ®µå…¶å®å°±æ˜¯ç”Ÿæˆäº†æˆ‘ä»¬ä¸Šé¢é‚£ä¸€æ®µä»£ç ï¼š

```js
_useCssVars((_ctx) => ({
  "5d92a9f9-color": color.value
}));
```

èµ°åˆ°è¿™é‡Œä½ ä¼šå‘ç°å¥½åƒèµ°ä¸ä¸‹å»äº†ï¼Œæ²¡æœ‰ä¸‹ä¸€æ­¥äº†ï¼Œå› ä¸ºæœ€ç»ˆæˆ‘ä»¬çœ‹åˆ°çš„ç¼–è¯‘åçš„ä»£ç å°±æ˜¯è¿™ä¸ªï¼Œå…·ä½“æ˜¯æ€ä¹ˆæŠŠ`style`ä¸­ä½¿ç”¨çš„å˜é‡è½¬æ¢æˆ`CSSå˜é‡`å¹¶è®¾ç½®åœ¨å¯¹åº”domèŠ‚ç‚¹ä¸Šçš„è¿™ä¸ªå¹¶ä¸æ˜¯åœ¨**ç¼–è¯‘æ—¶**å¤„ç†çš„ã€‚

æƒ³ææ¸…æ¥šè¿™ä¸ªæˆ‘ä»¬è¿˜å¾—åœ¨**è¿è¡Œæ—¶**æ‰“æ–­ç‚¹è°ƒè¯•ï¼ˆè¿™é‡Œæ¢æˆäº†ç«ç‹æµè§ˆå™¨è¿›è¡Œæ–­ç‚¹è°ƒè¯•ï¼Œä¸è¦é—®ä¸ºä»€ä¹ˆï¼Œé—®å°±æ˜¯æ–­ç‚¹è°ƒè¯•æ¯”è°·æ­Œå¥½ç”¨ï¼‰

![image-20241129200109901](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-13.png)

æ¥ç€å¾€ä¸‹èµ°ï¼Œä¼šæ¥åˆ°`setVars`æ–¹æ³•è¿™é‡Œ

![image-20241129200751995](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-14.png)

ä»æ–¹æ³•åæˆ‘ä»¬ä¸€çœ¼å°±èƒ½çœ‹å‡ºå®ƒå°±æ˜¯ç”¨æ¥è®¾ç½®CSSå˜é‡çš„ï¼

å†å¾€ä¸‹èµ°`setVars` -> `setVarsOnVNode` -> `setVarsOnNode`

![image-20241129201410148](/Users/songyao/Desktop/songyao/fe-nanjiu/article/2024/2024-10/images/2-15.png)

åœ¨è¿™é‡Œæœ€ç»ˆä¼šè°ƒç”¨`setProperty`æ–¹æ³•æ¥è®¾ç½®csså˜é‡ã€‚

åˆ°è¿™é‡Œæ•´ä¸ªæµç¨‹å°±ç»“æŸäº†ï¼















